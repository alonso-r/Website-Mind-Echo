<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Mind Echo Podcast</title>
  <meta name="description" content="Stories, strategies, and motivations of entrepreneurs shaping industries in Germany and beyond." />
  <link rel="canonical" href="https://www.mindecho.net/" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --brand: #1260e6; }
    .brand { color: var(--brand); }
    .bg-brand { background-color: var(--brand); }
    .ring-brand { --tw-ring-color: var(--brand); }
    body { font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; }
  </style>
</head>
<body class="bg-neutral-50 text-neutral-900">
  <!-- Header -->
  <header class="sticky top-0 z-40 bg-white/80 backdrop-blur border-b border-neutral-200">
    <div class="max-w-6xl mx-auto px-4 flex items-center justify-between h-16">
      <a href="#top" class="flex items-center gap-3">
        <!-- Logo: place /logo.png in the repo root -->
        <div class="w-10 h-10 rounded-xl overflow-hidden bg-white border border-neutral-200">
          <img src="/logo.png" alt="Mind Echo logo" class="h-full w-full object-contain" />
        </div>
        <div class="leading-tight">
          <div class="font-semibold">Mind Echo Podcast</div>
          <div class="text-xs text-neutral-500">with Alonso Rondón Tello</div>
        </div>
      </a>
      <nav class="hidden sm:flex items-center gap-6 text-sm">
        <a href="#episodes" class="hover:text-neutral-600">Episodes</a>
        <a href="#contact" class="hover:text-neutral-600">Contact</a>
        <a href="#subscribe" class="hover:text-neutral-600">Subscribe</a>
      </nav>
      <a href="#subscribe" class="inline-flex items-center rounded-xl bg-brand text-white px-3 py-2 text-sm font-medium shadow-sm hover:opacity-90 focus:outline-none focus:ring-2 ring-brand">Subscribe</a>
    </div>
  </header>

  <!-- HERO / PLAYER -->
  <section id="listen" class="bg-brand text-white">
    <div class="max-w-6xl mx-auto px-4 py-12 md:py-16 grid md:grid-cols-2 gap-10 items-center">
      <div>
        <h1 class="text-3xl md:text-4xl font-bold tracking-tight">Conversations that echo beyond the moment</h1>
        <p class="mt-4 text-neutral-100">Deep-dive stories with founders, leaders, and innovators in Germany and beyond. New episodes twice a month.</p>
        <div class="mt-6 flex items-center gap-3">
          <a href="#episodes" class="inline-flex items-center rounded-xl bg-white text-neutral-900 px-4 py-2 text-sm font-medium shadow-sm hover:bg-white/90">Browse episodes</a>
          <a href="#contact" class="inline-flex items-center rounded-xl border border-white bg-transparent text-white px-4 py-2 text-sm font-medium hover:bg-white/10">Get in touch</a>
        </div>
      </div>
      <div class="rounded-2xl border border-white/40 overflow-hidden shadow-sm bg-white">
        <div id="bzplayer" class="w-full"></div>
        <script async src="https://www.buzzsprout.com/2392678.js?container_id=bzplayer&player=large"></script>
      </div>
    </div>
  </section>

  <!-- EPISODES (from RSS via Vercel function) -->
  <section id="episodes" class="border-t border-neutral-200 bg-white">
    <div class="max-w-6xl mx-auto px-4 py-12 md:py-16">
      <div class="flex items-end justify-between gap-6 mb-6">
        <h2 class="text-2xl md:text-3xl font-semibold">Latest Episodes</h2>
        <div class="text-sm text-neutral-500">Powered by your RSS feed</div>
      </div>
      <div id="feed-status" class="hidden mb-6 text-sm"></div>
      <div id="episodes-grid" class="grid sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
    </div>
  </section>

  <!-- SUBSCRIBE (blue banner + brand-color buttons) -->
  <section id="subscribe" class="bg-brand text-white">
    <div class="max-w-6xl mx-auto px-4 py-12 md:py-16 grid md:grid-cols-2 gap-10 items-center">
      <div>
        <h3 class="text-2xl md:text-3xl font-semibold">Never miss an episode</h3>
        <p class="mt-3 text-white/90">Subscribe on your favorite platform.</p>
      </div>
      <div class="flex flex-wrap items-center gap-3">
        <a href="https://open.spotify.com/show/1iKCYcV0iHEdEm1vR1SusJ" target="_blank" rel="noopener" class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm bg-[#1ED760] text-black">Spotify</a>
        <a href="https://podcasts.apple.com/us/podcast/mind-echo-stories-of-entrepreneurs-innovators-in/id1786857403" target="_blank" rel="noopener" class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm bg-[#B150E2] text-white">Apple Podcasts</a>
        <a href="https://www.youtube.com/@mindechopodcast" target="_blank" rel="noopener" class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm bg-[#FF0000] text-white">YouTube</a>
        <a href="https://www.linkedin.com/in/alonsorondontello/" target="_blank" rel="noopener" class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm bg-[#0A66C2] text-white">LinkedIn</a>
        <a href="https://www.instagram.com/mindechopodcast/" target="_blank" rel="noopener" class="inline-flex items-center rounded-xl px-4 py-2 text-sm font-medium shadow-sm bg-[#E1306C] text-white">Instagram</a>
      </div>
    </div>
  </section>

  <!-- CONTACT (centered form only) -->
  <section id="contact" class="bg-white">
    <div class="max-w-6xl mx-auto px-4 py-12 md:py-16">
      <div class="max-w-xl mx-auto">
        <h3 class="text-2xl md:text-3xl font-semibold text-center">Contact</h3>
        <p class="mt-3 text-neutral-600 text-center">For bookings, partnerships, or feedback, reach out anytime.</p>
        <form id="contact-form" action="https://formsubmit.co/contact.alonsorondon@gmail.com" method="POST" class="mt-6 bg-neutral-50 border border-neutral-200 rounded-2xl p-6 shadow-sm">
          <input type="hidden" name="_subject" value="Mind Echo: New contact form submission">
          <input type="hidden" name="_captcha" value="false">
          <input type="hidden" name="_next" value="https://www.mindecho.net/?submitted=1#contact">
          <input type="text" name="_honey" style="display:none">
          <div class="grid gap-4">
            <div>
              <label for="name" class="block text-sm font-medium text-neutral-700">Name</label>
              <input id="name" name="name" type="text" required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-3 py-2 focus:outline-none focus:ring-2 ring-brand" />
            </div>
            <div>
              <label for="email" class="block text-sm font-medium text-neutral-700">Email</label>
              <input id="email" name="email" type="email" required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-3 py-2 focus:outline-none focus:ring-2 ring-brand" />
            </div>
            <div>
              <label for="message" class="block text-sm font-medium text-neutral-700">Message</label>
              <textarea id="message" name="message" rows="5" required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-3 py-2 focus:outline-none focus:ring-2 ring-brand"></textarea>
            </div>
            <button type="submit" class="inline-flex justify-center items-center rounded-xl bg-brand text-white px-4 py-2 text-sm font-medium shadow-sm hover:opacity-90">Send</button>
            <p id="form-status" class="hidden text-sm text-green-600 text-center">Thanks! Your message was sent.</p>
            <p class="text-xs text-neutral-500 text-center">Form powered by <a class="underline" href="https://formsubmit.co/" target="_blank" rel="noopener">FormSubmit</a>.</p>
          </div>
        </form>
      </div>
    </div>
  </section>

  <!-- Footer -->
  <footer class="border-t border-neutral-200 bg-white">
    <div class="max-w-6xl mx-auto px-4 py-8 flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-neutral-600">
      <div>© <span id="year"></span> Mind Echo Podcast</div>
      <div class="flex items-center gap-4">
        <a href="#" class="underline decoration-neutral-300 hover:decoration-transparent">Privacy</a>
        <a href="#" class="underline decoration-neutral-300 hover:decoration-transparent">Imprint</a>
      </div>
    </div>
  </footer>

  <script>
    document.getElementById('year').textContent = new Date().getFullYear();

    const statusEl = document.getElementById('feed-status');
    const gridEl = document.getElementById('episodes-grid');

    // Optional overrides loaded from /artworks.json
    let ART_OVERRIDES = { byGuid: {}, byTitle: [] };
    async function loadOverrides(){
      try {
        const res = await fetch('/artworks.json', { cache: 'no-store' });
        if (res.ok) ART_OVERRIDES = await res.json();
      } catch(e) { /* ignore */ }
    }

    // Map of per-episode artwork scraped from the Buzzsprout embed (title -> image URL)
    const EMBED_ARTWORKS = new Map();
    const normTitle = (s) => (s || '').toLowerCase().replace(/\s+/g,' ').trim();

    // Apply embed artwork to already-rendered cards (after the embed loads)
    function applyEmbedArtworks(){
      try {
        gridEl.querySelectorAll('article').forEach(card => {
          const title = card.querySelector('h3')?.textContent || '';
          const art = EMBED_ARTWORKS.get(normTitle(title));
          if (!art) return;
          const img = card.querySelector('img');
          if (img && img.getAttribute('src') !== art) {
            img.setAttribute('src', art);
          }
        });
      } catch(e) { /* ignore */ }
    }

    async function fetchText(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error('Network response was not ok');
      return await res.text();
    }

    async function loadFeed() {
      statusEl.classList.add('hidden');
      gridEl.innerHTML = '';

      let xmlText = null;
      try { xmlText = await fetchText('/api/rss'); } catch (e) {}

      if (!xmlText) {
        statusEl.textContent = 'Could not load RSS feed from /api/rss. Check that your Vercel function exists at /api/rss.js';
        statusEl.className = 'mb-6 text-sm text-red-600';
        statusEl.classList.remove('hidden');
        return;
      }

      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlText, 'application/xml');
      const channelImage = xml.querySelector('channel > itunes\\:image')?.getAttribute('href')
        || xml.querySelector('channel > image > url')?.textContent?.trim() || '';

      let items = Array.from(xml.querySelectorAll('item'));

      // Hide teaser by title or GUID
      const HIDE_TITLES = ['teaser'];
      const HIDE_GUIDS = [];
      items = items.filter((item) => {
        const t = (item.querySelector('title')?.textContent || '').toLowerCase();
        const guid = (item.querySelector('guid')?.textContent || '').trim();
        const byTitle = HIDE_TITLES.some(x => x && t.includes(x));
        const byGuid = HIDE_GUIDS.length ? HIDE_GUIDS.includes(guid) : false;
        return !(byTitle || byGuid);
      });

      if (!items.length) {
        statusEl.textContent = 'No episodes to display.';
        statusEl.className = 'mb-6 text-sm text-neutral-600';
        statusEl.classList.remove('hidden');
        return;
      }

      const dateFmt = new Intl.DateTimeFormat(undefined, { year: 'numeric', month: 'short', day: 'numeric' });

      items.slice(0, 30).forEach((item) => {
        const title = item.querySelector('title')?.textContent?.trim() || 'Untitled Episode';
        const link = item.querySelector('link')?.textContent?.trim() || '#';
        const guid = (item.querySelector('guid')?.textContent || '').trim();
        const lowerTitle = title.toLowerCase();
        const pubDateRaw = item.querySelector('pubDate')?.textContent;
        const pubDate = pubDateRaw ? dateFmt.format(new Date(pubDateRaw)) : '';
        const desc = (item.querySelector('description')?.textContent || item.querySelector('content\\:encoded')?.textContent || '').replace(/<[^>]+>/g, '').trim();
        const enclosure = item.querySelector('enclosure');
        const audioUrl = enclosure?.getAttribute('url') || '';

        // Episode artwork: try several sources (per-episode first)
        let imageUrl = '';
        const itunesImg = item.querySelector('itunes\\:image')?.getAttribute('href');
        const mediaUrl = item.querySelector('media\\:thumbnail')?.getAttribute('url') || item.querySelector('media\\:content')?.getAttribute('url');
        if (itunesImg) imageUrl = itunesImg; else if (mediaUrl) imageUrl = mediaUrl; else {
          const htmlBlob = item.querySelector('content\\:encoded')?.textContent || item.querySelector('description')?.textContent || '';
          if (htmlBlob) {
            try {
              const htmlDoc = new DOMParser().parseFromString(htmlBlob, 'text/html');
              const imgEl = htmlDoc.querySelector('img');
              if (imgEl) imageUrl = imgEl.getAttribute('src') || '';
            } catch (e) {}
          }
        }
        // Apply manual overrides (preferred)
        if (!imageUrl && ART_OVERRIDES?.byGuid && ART_OVERRIDES.byGuid[guid]) {
          imageUrl = ART_OVERRIDES.byGuid[guid];
        }
        if (!imageUrl && Array.isArray(ART_OVERRIDES?.byTitle)) {
          for (const r of ART_OVERRIDES.byTitle) {
            if ((r?.match || '') && lowerTitle.includes(String(r.match).toLowerCase())) { imageUrl = r.image; break; }
          }
        }
        // Fallback to artwork found inside the Buzzsprout embed
        if (!imageUrl) {
          const art = EMBED_ARTWORKS.get(normTitle(title));
          if (art) imageUrl = art;
        }
        // Final fallback to channel artwork
        if (!imageUrl) imageUrl = channelImage;

        // Card
        const card = document.createElement('article');
        card.className = 'rounded-2xl border border-neutral-200 overflow-hidden bg-white shadow-sm flex flex-col';

        const topRow = document.createElement('div');
        topRow.className = 'p-5 flex gap-4 items-start';

        const thumb = document.createElement('div');
        thumb.className = 'thumb w-24 h-24 min-w-[6rem] rounded-xl overflow-hidden bg-neutral-100 flex-shrink-0';
        thumb.innerHTML = imageUrl
          ? `<img src="${imageUrl}" alt="${title} artwork" class="w-full h-full object-cover" loading="lazy">`
          : '';
        topRow.appendChild(thumb);

        const body = document.createElement('div');
        body.className = 'flex-1 flex flex-col';
        topRow.appendChild(body);
        body.innerHTML = `
          <a href="${link}" target="_blank" rel="noopener" class="block">
            <h3 class="text-lg font-semibold line-clamp-2 hover:underline decoration-neutral-300 hover:decoration-transparent">${title}</h3>
          </a>
          <div class="mt-1 text-xs text-neutral-500">${pubDate}</div>
          <p class="episode-desc mt-3 text-sm text-neutral-600 line-clamp-4">${desc}</p>
          <button type="button" class="read-more mt-2 text-sm underline brand">Read more</button>
        `;

        const playerWrap = document.createElement('div');
        playerWrap.className = 'p-5 pt-0';
        if (audioUrl) {
          playerWrap.innerHTML = `
            <audio controls preload="none" class="w-full mt-3">
              <source src="${audioUrl}" type="audio/mpeg" />
              Your browser does not support the audio element.
            </audio>
          `;
        } else {
          playerWrap.innerHTML = `<a href="${link}" target="_blank" rel="noopener" class="text-sm underline">Listen on your platform</a>`;
        }

        // Read more toggler
        const descEl = body.querySelector('.episode-desc');
        const btn = body.querySelector('.read-more');
        if (btn && descEl) {
          if ((desc || '').length < 240) btn.classList.add('hidden');
          btn.addEventListener('click', () => {
            const clamped = descEl.classList.contains('line-clamp-4');
            if (clamped) {
              descEl.classList.remove('line-clamp-4');
              btn.textContent = 'Read less';
            } else {
              descEl.classList.add('line-clamp-4');
              btn.textContent = 'Read more';
            }
          });
        }

        card.appendChild(topRow);
        card.appendChild(playerWrap);
        gridEl.appendChild(card);
      });
    }

    (async function init(){ await loadOverrides(); await loadFeed(); })();

    // Show success message after redirect from form
    try { const params = new URLSearchParams(location.search); if (params.get('submitted') === '1') { const fs = document.getElementById('form-status'); if (fs) fs.classList.remove('hidden'); } } catch(e) {}

    // Enhance Buzzsprout embed: hide teaser + harvest per-episode artwork
    (function enhanceBuzzsproutEmbed(){
      const container = document.getElementById('bzplayer');
      if (!container) return;
      const HIDE_TITLES = ['teaser'];
      const matches = (txt) => HIDE_TITLES.some(t => t.includes && txt.includes(t));

      // Collect per-episode artwork from the embed and store in EMBED_ARTWORKS
      const collectArtworks = () => {
        try {
          container.querySelectorAll('[data-file-name],[original-url]').forEach(el => {
            const url = el.getAttribute('data-file-name') || el.getAttribute('original-url');
            if (!url) return;
            const row = el.closest('li, .episode, .buzzsprout-player-episode, .bsp-episode, .buzzsprout-episode') || el.parentElement;
            let title = '';
            if (row) {
              const tEl = row.querySelector('h1,h2,h3,h4,.title,a');
              title = (tEl?.textContent || row.textContent || '').trim();
            }
            title = normTitle(title).slice(0,140);
            if (title) EMBED_ARTWORKS.set(title, url);
          });
          // Immediately apply to any already-rendered cards
          applyEmbedArtworks();
        } catch(e) { /* ignore */ }
      };

      const scan = () => {
        // Hide teaser rows
        const all = container.querySelectorAll('*');
        all.forEach(node => {
          const txt = (node.textContent || '').toLowerCase();
          if (matches(txt)) {
            const row = node.closest('li, .episode, .buzzsprout-player-episode, .bsp-episode, .buzzsprout-episode');
            if (row) row.style.display = 'none';
          }
        });
        collectArtworks();
      };

      const obs = new MutationObserver(scan);
      obs.observe(container, { childList: true, subtree: true });
      scan();
    })();
  </script>
</body>
</html>
